<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <!-- Onglets de navigation -->
      <ul class="nav nav-tabs mb-4" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link" [class.active]="activeTab === 'track'" (click)="setActiveTab('track')" type="button" role="tab">
            <i class="las la-search me-1"></i>Rechercher un colis
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" [class.active]="activeTab === 'register'" (click)="setActiveTab('register')" type="button" role="tab">
            <i class="las la-plus-circle me-1"></i>Enregistrer un colis
          </button>
        </li>
      </ul>

      <!-- Messages d'information -->
      <div *ngIf="message" class="alert" [ngClass]="{'alert-success': message.type === 'success', 'alert-danger': message.type === 'error', 'alert-info': message.type === 'info'}">
        {{ message.text }}
      </div>

      <!-- Onglet de recherche de colis -->
      <div *ngIf="activeTab === 'track'" class="tab-content">
        <div class="card shadow-sm">
          <div class="card-header bg-primary text-white">
            <h2 class="h4 mb-0">Recherche de Colis</h2>
          </div>
          <div class="card-body">
            <form [formGroup]="trackingForm" (ngSubmit)="searchPackage()">
              <div class="mb-3">
                <label for="codeSuivi" class="form-label">Code de suivi</label>
                <div class="input-group">
                  <input type="text" class="form-control" id="codeSuivi" formControlName="codeSuivi" placeholder="Entrez le code de suivi">
                  <button class="btn btn-primary" type="submit" [disabled]="trackingForm.invalid || isLoading">
                    <i class="las la-search me-1"></i>Rechercher
                  </button>
                </div>
                <div class="form-text text-danger" *ngIf="trackingForm.get('codeSuivi')?.invalid && trackingForm.get('codeSuivi')?.touched">
                  Le code de suivi est requis
                </div>
              </div>
            </form>

            <!-- Résultat de la recherche -->
            <div *ngIf="colis && !isLoading" class="mt-4">
              <div class="card">
                <div class="card-header bg-light">
                  <h3 class="h5 mb-0">Détails du colis</h3>
                </div>
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-6">
                      <p><strong>Code de suivi:</strong> {{ colis.codeSuivi }}</p>
                      <p><strong>Type:</strong> {{ getColisTypeLabel(colis.type) }}</p>
                      <p><strong>Type d'expédition:</strong> {{ getTypeExpeditionLabel(colis.typeExpedition) }}</p>
                      <p><strong>Poids:</strong> {{ colis.poids }} kg</p>
                      <p><strong>Coût:</strong> {{ colis.cout | currency:'XOF':'symbol' }}</p>
                    </div>
                    <div class="col-md-6">
                      <p><strong>Destinataire:</strong> {{ colis.destinataire }}</p>
                      <p><strong>Destination:</strong> {{ colis.destination }}</p>
                      <p><strong>Quantité:</strong> {{ colis.quantite }}</p>
                      <p><strong>Nature:</strong> {{ colis.nature }}</p>
                      <p><strong>Transporteur:</strong> {{ colis.transporteur }}</p>
                    </div>
                  </div>
                  
                  <div class="mt-3">
                    <p><strong>Description:</strong> {{ colis.description || 'Aucune description' }}</p>
                  </div>
                  
                  <div class="mt-3">
                    <p><strong>Statut:</strong> 
                      <span class="badge" [ngClass]="getColisStatusClass(colis.statut)">
                        {{ getColisStatusLabel(colis.statut) }}
                      </span>
                    </p>
                    <p><strong>Date de création:</strong> {{ formatDate(colis.dateCreation) }}</p>
                  </div>
                  
                  <!-- Bouton de paiement si le colis est en attente de paiement -->
                  <div *ngIf="colis.statut === STATUT_COLIS.EN_ATTENTE_PAIEMENT" class="mt-3">
                    <button class="btn btn-success" (click)="colis.id ? processPayment(colis.id) : null" [disabled]="isProcessingPayment">
                      <i class="las la-credit-card me-1"></i>Payer maintenant
                    </button>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Indicateur de chargement -->
            <div *ngIf="isLoading" class="text-center my-5">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Chargement...</span>
              </div>
              <p class="mt-2">Recherche en cours...</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Onglet d'enregistrement de colis -->
      <div *ngIf="activeTab === 'register'" class="tab-content">
        <div class="card shadow-sm">
          <div class="card-header bg-primary text-white">
            <h2 class="h4 mb-0">Enregistrement de Colis</h2>
          </div>
          <div class="card-body">
            <!-- Formulaire de colis -->
            <form [formGroup]="colisForm" (ngSubmit)="onColisSubmit()">
              <!-- Messages d'erreur et de succès -->
              <div class="alert alert-danger" *ngIf="errorMessage">
                {{ errorMessage }}
              </div>
              <div class="alert alert-success" *ngIf="successMessage">
                {{ successMessage }}
              </div>

              <!-- Informations du colis -->
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">Type de colis</label>
                  <select class="form-select" formControlName="type">
                    <option value="">Sélectionnez un type</option>
                    <option *ngFor="let type of colisTypes" [value]="type.value">{{ type.label }}</option>
                  </select>
                  <div class="form-text text-danger" *ngIf="colisForm.get('type')?.invalid && colisForm.get('type')?.touched">
                    Le type de colis est requis
                  </div>
                </div>

                <div class="col-md-6 mb-3">
                  <label class="form-label">Type d'expédition</label>
                  <select class="form-select" formControlName="typeExpedition">
                    <option value="">Sélectionnez un type</option>
                    <option *ngFor="let type of getTypeExpeditionOptions()" [value]="type.value">{{ type.label }}</option>
                  </select>
                  <div class="form-text text-danger" *ngIf="colisForm.get('typeExpedition')?.invalid && colisForm.get('typeExpedition')?.touched">
                    Le type d'expédition est requis
                  </div>
                </div>

                <div class="col-md-6 mb-3">
                  <label class="form-label">Poids (kg)</label>
                  <input type="number" class="form-control" formControlName="poids" step="0.1">
                </div>

                <div class="col-md-6 mb-3">
                  <label class="form-label">Coût</label>
                  <input type="number" class="form-control" formControlName="cout" step="0.01">
                </div>

                <div class="col-md-6 mb-3">
                  <label class="form-label">Code de suivi</label>
                  <input type="text" class="form-control" formControlName="codeSuivi">
                  <div class="form-text text-danger" *ngIf="colisForm.get('codeSuivi')?.invalid && colisForm.get('codeSuivi')?.touched">
                    Le code de suivi est requis
                  </div>
                </div>

                <div class="col-md-6 mb-3">
                  <label class="form-label">Destinataire</label>
                  <input type="text" class="form-control" formControlName="destinataire">
                  <div class="form-text text-danger" *ngIf="colisForm.get('destinataire')?.invalid && colisForm.get('destinataire')?.touched">
                    Le destinataire est requis
                  </div>
                </div>

                <div class="col-md-6 mb-3">
                  <label class="form-label">Destination</label>
                  <input type="text" class="form-control" formControlName="destination">
                  <div class="form-text text-danger" *ngIf="colisForm.get('destination')?.invalid && colisForm.get('destination')?.touched">
                    La destination est requise
                  </div>
                </div>

                <div class="col-md-6 mb-3">
                  <label class="form-label">Quantité</label>
                  <input type="text" class="form-control" formControlName="quantite">
                  <div class="form-text text-danger" *ngIf="colisForm.get('quantite')?.invalid && colisForm.get('quantite')?.touched">
                    La quantité est requise
                  </div>
                </div>

                <div class="col-md-6 mb-3">
                  <label class="form-label">Nature</label>
                  <input type="text" class="form-control" formControlName="nature">
                  <div class="form-text text-danger" *ngIf="colisForm.get('nature')?.invalid && colisForm.get('nature')?.touched">
                    La nature est requise
                  </div>
                </div>

                <div class="col-md-6 mb-3">
                  <label class="form-label">Transporteur</label>
                  <input type="text" class="form-control" formControlName="transporteur">
                  <div class="form-text text-danger" *ngIf="colisForm.get('transporteur')?.invalid && colisForm.get('transporteur')?.touched">
                    Le transporteur est requis
                  </div>
                </div>

                <div class="col-12 mb-3">
                  <label class="form-label">Description</label>
                  <textarea class="form-control" formControlName="description" rows="3"></textarea>
                </div>

                <!-- Tableau des colis enregistrés -->
                <div class="col-12 mb-3" *ngIf="colisList.length > 0">
                  <div class="card">
                    <div class="card-header bg-light">
                      <h5 class="mb-0">Colis enregistrés</h5>
                    </div>
                    <div class="card-body p-0">
                      <div class="table-responsive">
                        <table class="table table-hover mb-0">
                          <thead class="table-light">
                            <tr>
                              <th>Code de suivi</th>
                              <th>Type</th>
                              <th>Type d'expédition</th>
                              <th>Poids</th>
                              <th>Destinataire</th>
                              <th>Destination</th>
                              <th>Quantité</th>
                              <th>Nature</th>
                              <th>Transporteur</th>
                              <th class="text-end">Coût</th>
                              <th class="text-center">Actions</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr *ngFor="let colis of colisList; let i = index">
                              <td>{{ colis.codeSuivi }}</td>
                              <td>{{ getTypeColisLabel(colis.type) }}</td>
                              <td>{{ getTypeExpeditionLabel(colis.typeExpedition) }}</td>
                              <td>{{ colis.poids }} kg</td>
                              <td>{{ colis.destinataire }}</td>
                              <td>{{ colis.destination }}</td>
                              <td>{{ colis.quantite }}</td>
                              <td>{{ colis.nature }}</td>
                              <td>{{ colis.transporteur }}</td>
                              <td class="text-end fw-bold">{{ colis.cout | currency:'XOF':'symbol' }}</td>
                              <td class="text-center">
                                <button type="button" class="btn btn-sm btn-danger" (click)="removeColisFromList(i)">
                                  <i class="las la-trash"></i>
                                </button>
                              </td>
                            </tr>
                          </tbody>
                          <tfoot class="table-light">
                            <tr>
                              <td colspan="9" class="text-end fw-bold">Total</td>
                              <td class="text-end fw-bold">{{ getTotalCost() | currency:'XOF':'symbol' }}</td>
                              <td></td>
                            </tr>
                          </tfoot>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="col-12">
                  <div class="d-flex gap-2">
                    <button type="button" class="btn btn-primary" (click)="addColisToList()" [disabled]="colisForm.invalid">
                      <i class="las la-plus me-1"></i>Ajouter un autre colis
                    </button>
                    <button type="submit" class="btn btn-success" [disabled]="colisList.length === 0 || isLoading">
                      <i class="las" [ngClass]="{'la-check': !isLoading, 'la-spinner la-spin': isLoading}"></i>
                      <span class="ms-1">{{ isLoading ? 'Traitement en cours...' : 'Enregistrer' }}</span>
                    </button>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
